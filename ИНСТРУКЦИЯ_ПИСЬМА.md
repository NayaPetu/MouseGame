# Инструкция по добавлению системы писем друга

## Созданные скрипты

1. **LetterManager.cs** - Менеджер для управления письмами с ID и текстами
2. **FriendNote.cs** - Обновлен для работы с ID и показом UI
3. **LetterUI.cs** - Управление UI панелью письма
4. **ItemPickup.cs** - Обновлен, чтобы письма не уничтожались
5. **LetterSpawner.cs** - НОВЫЙ: Отдельный спавнер для писем на специальных спавн-поинтах

## Шаг 1: Настройка LetterManager

1. В сцене `main.unity` создайте пустой GameObject с именем `LetterManager`
2. Добавьте компонент `LetterManager` на этот объект
3. В инспекторе настройте письма:
   - **Main Floor Letters** - список писем для этажа
   - **Basement Letters** - список писем для подвала
4. Для каждого письма укажите:
   - **ID** - уникальный номер письма
   - **Text** - текст письма
   - **Floor Category** - этаж (Main или Basement)

Пример настройки:
- Письмо 1: ID=1, Text="Привет! Это письмо с этажа", Floor=Main
- Письмо 2: ID=2, Text="Другое письмо с этажа", Floor=Main
- Письмо 3: ID=3, Text="Письмо из подвала", Floor=Basement

**ВАЖНО:** Убедитесь, что нет дублирующихся ID! Каждое письмо должно иметь уникальный ID.

## Шаг 2: Создание UI панели для письма

1. Найдите Canvas в сцене (обычно называется "Canvas")
2. В Canvas создайте новый GameObject с именем `LetterPanel`
3. Настройте `LetterPanel`:
   - Добавьте компонент `Image` (для фона панели)
   - Установите цвет фона (например, бежевый или кремовый)
   - Установите размер примерно 600x400 пикселей
   - Расположите по центру экрана

4. Внутри `LetterPanel` создайте:
   - **Text (TextMeshPro)** - для текста письма
     - Имя: `LetterText`
     - Настройте шрифт, размер, выравнивание
     - Установите размер текстового поля (чтобы текст помещался)
   - **Button** - кнопка закрытия
     - Имя: `CloseButton`
     - Текст кнопки: "Закрыть" или "X"
     - Расположите в правом верхнем углу панели

5. Создайте темный фон (если его еще нет):
   - В Canvas создайте GameObject с именем `DarkBackground`
   - Добавьте компонент `Image`
   - Установите черный цвет с прозрачностью ~0.7
   - Установите размер на весь экран (Anchor: stretch-stretch)
   - Установите порядок отрисовки ниже панели письма

## Шаг 3: Настройка LetterUI

1. На Canvas добавьте компонент `LetterUI`
2. В инспекторе назначьте:
   - **Letter Panel** - перетащите `LetterPanel`
   - **Letter Text** - перетащите `LetterText` (TextMeshPro компонент)
   - **Close Button** - перетащите `CloseButton`
   - **Dark Background** - перетащите `DarkBackground`

## Шаг 4: Создание префаба письма

1. Создайте новый GameObject с именем `FriendNote` (или используйте существующий `Letter.prefab`)
2. Добавьте компоненты:
   - **SpriteRenderer** - для визуального отображения письма
     - Назначьте спрайт письма (из папки Art/Sprites или создайте свой)
   - **FriendNote** - компонент письма
     - **Letter Id** - оставьте -1 для случайного письма, или укажите конкретный ID
   - **ItemPickup** - компонент для подбора
   - **Collider2D** (Trigger) - для обнаружения игрока
     - Установите `Is Trigger = true`
     - Настройте размер коллайдера

3. Сохраните как префаб в папку `Assets/Prefabs/Items/`

## Шаг 5: Создание спавн-поинтов для писем

1. Откройте префабы этажей (`Floor_1 1.prefab` или `Basement.prefab`)
2. В иерархии этажа создайте пустые GameObject'ы для спавн-поинтов писем
3. Назовите их, например, `LetterSpawnPoint1`, `LetterSpawnPoint2`, и т.д.
4. **ВАЖНО:** Установите тег `SpawnPoint_Letter` для каждого из этих объектов
   - Если тега еще нет, создайте его в `Edit > Project Settings > Tags and Layers`
   - Добавьте тег `SpawnPoint_Letter` в список тегов
5. Разместите спавн-поинты в подходящих местах на этаже (например, на столах, полках, в углах комнат)
6. Повторите для всех префабов этажей

## Шаг 6: Настройка LetterSpawner на префабах этажей

1. Откройте префаб этажа (`Floor_1 1.prefab` или `Basement.prefab`)
2. Найдите объект с компонентом `ItemSpawner` (или создайте новый пустой GameObject)
3. На этот же объект (или создайте отдельный) добавьте компонент `LetterSpawner`
4. В инспекторе `LetterSpawner` настройте:
   - **Letter Prefab** - перетащите префаб `Letter` (или `FriendNote`)
   - **Spawn Point Tag** - оставьте `SpawnPoint_Letter` (или создайте свой тег)
   - **Min Count** - минимальное количество писем (например, 0)
   - **Max Count** - максимальное количество писем (например, 2)
   - **Collision Layers** - настройте слои для проверки коллизий (как в ItemSpawner)
   - **Check Radius** - радиус проверки коллизий (например, 0.5)
   - **Max Attempts** - максимальное количество попыток спавна (например, 20)
5. Сохраните префаб

## Шаг 7: Проверка работы

1. Запустите игру
2. Письма должны случайно спавниться на точках спавна с тегом `SpawnPoint_Letter`
3. При приближении к письму оно должно открываться
4. UI панель должна показывать текст письма
5. Нажатие Escape или кнопки закрытия должно закрывать письмо
6. Письмо не должно исчезать после прочтения (можно читать повторно)

## Дополнительные настройки

### Разные письма для разных этажей
- В `LetterManager` настройте отдельные списки для Main и Basement
- Письма будут автоматически выбираться в зависимости от текущего этажа

### Специфичные письма
- Если хотите, чтобы конкретное письмо всегда имело определенный ID:
  - В префабе `FriendNote` установите `Letter Id` на нужное значение
  - Письмо с ID=-1 будет случайным для этажа

### Настройка внешнего вида
- Измените спрайт письма в `SpriteRenderer`
- Настройте стиль UI панели (цвета, шрифты, размеры)
- Добавьте анимации появления/исчезновения панели

## Важные замечания

- `LetterManager` должен быть в сцене до начала игры
- `LetterUI` должен быть на Canvas
- Убедитесь, что у письма есть коллайдер с `Is Trigger = true`
- Письма не уничтожаются при подборе, в отличие от других предметов
- Время останавливается при открытии письма (Time.timeScale = 0)
- **Спавн-поинты для писем должны иметь тег `SpawnPoint_Letter`**
- **LetterSpawner должен быть добавлен на префабы этажей**
- **Убедитесь, что в LetterManager нет дублирующихся ID писем**

## Решение проблем

### Письма не спавнятся
- Проверьте, что спавн-поинты имеют правильный тег `SpawnPoint_Letter`
- Проверьте, что `LetterSpawner` добавлен на префаб этажа
- Проверьте, что префаб письма назначен в `LetterSpawner`
- Проверьте, что в `LetterManager` есть письма для текущего этажа
- Проверьте консоль на наличие предупреждений

### Письма с дублирующимся ID
- Проверьте настройки `LetterManager` в сцене
- Убедитесь, что каждое письмо имеет уникальный ID
- Код выводит предупреждение при обнаружении дубликатов
